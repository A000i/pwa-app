<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å­¦è¡“çš„æ ¹æ‹ ä»˜ãAIè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ  - å‹•ä½œç¢ºèª</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 3px solid #007bff;
        padding-bottom: 15px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #dee2e6;
        border-radius: 8px;
      }
      .test-section h3 {
        color: #007bff;
        margin-top: 0;
      }
      .academic-icon {
        font-size: 18px;
        margin-right: 5px;
      }
      .citation {
        background: #f8f9fa;
        padding: 8px;
        border-left: 4px solid #007bff;
        margin: 5px 0;
        font-style: italic;
      }
      .evaluation-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #ccc;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .evaluation-item:hover {
        background-color: #f8f9fa;
      }
      .score {
        font-weight: bold;
      }
      .score.excellent {
        color: #28a745;
      }
      .score.good {
        color: #ffc107;
      }
      .score.normal {
        color: #6c757d;
      }
      .score.poor {
        color: #dc3545;
      }
      .button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      .button:hover {
        background: #0056b3;
      }
      .button.success {
        background: #28a745;
      }
      .button.warning {
        background: #ffc107;
        color: #212529;
      }
      .log {
        background: #f8f9fa;
        border: 1px solid #ccc;
        padding: 10px;
        height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
      .academic-summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }
      .thesis-ready {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ“š å­¦è¡“çš„æ ¹æ‹ ä»˜ãAIè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ </h1>
        <p>å’ç ”ç™ºè¡¨ç”¨ - å‹•ä½œç¢ºèªãƒ»ãƒ‡ãƒ¢</p>
      </div>

      <!-- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ– -->
      <div class="test-section">
        <h3>ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</h3>
        <button class="button" onclick="initializeSystem()">
          å­¦è¡“ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
        </button>
        <button class="button warning" onclick="loadTestData()">
          ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        </button>
        <div id="initStatus" class="log" style="height: 100px"></div>
      </div>

      <!-- ãƒ†ã‚¹ãƒˆè©•ä¾¡å®Ÿè¡Œ -->
      <div class="test-section">
        <h3>ğŸ§ª AIè©•ä¾¡ãƒ†ã‚¹ãƒˆ</h3>
        <p>
          ç•°ãªã‚‹ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã§AIè©•ä¾¡ã‚’å®Ÿè¡Œã—ã€å­¦è¡“çš„æ ¹æ‹ ã®è¡¨ç¤ºã‚’ç¢ºèªã—ã¾ã™ã€‚
        </p>

        <button class="button success" onclick="runExpertTest()">
          ç†Ÿç·´è€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡
        </button>
        <button class="button" onclick="runIntermediateTest()">
          ä¸­ç´šè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡
        </button>
        <button class="button warning" onclick="runBeginnerTest()">
          åˆå¿ƒè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡
        </button>

        <div id="testResults" style="margin-top: 15px"></div>
      </div>

      <!-- å­¦è¡“çš„æ ¹æ‹ è¡¨ç¤º -->
      <div class="test-section">
        <h3>ğŸ“Š å­¦è¡“çš„æ ¹æ‹ ã®è©³ç´°</h3>
        <div id="academicEvidence"></div>
        <div id="evaluationList"></div>
      </div>

      <!-- å’ç ”ç™ºè¡¨ç”¨ãƒ‡ãƒ¼ã‚¿ -->
      <div class="test-section">
        <h3>ğŸ“ å’ç ”ç™ºè¡¨ç”¨æ©Ÿèƒ½</h3>
        <button class="button" onclick="showThesisData()">
          ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
        </button>
        <button class="button" onclick="exportThesisData()">
          ç™ºè¡¨ç”¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        </button>
        <button class="button warning" onclick="clearThesisData()">
          ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        </button>

        <div id="thesisDataDisplay"></div>
      </div>

      <!-- ãƒ­ã‚°è¡¨ç¤º -->
      <div class="test-section">
        <h3>ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</h3>
        <div id="systemLog" class="log"></div>
        <button class="button" onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
      </div>
    </div>

    <!-- å­¦è¡“çš„æ ¹æ‹ ä»˜ãè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã®èª­ã¿è¾¼ã¿ -->
    <script src="academic-evaluator.js"></script>

    <script>
      let academicEvaluator = null;
      let testPoseData = null;

      // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
      function log(message, type = "info") {
        const logDiv = document.getElementById("systemLog");
        const timestamp = new Date().toLocaleTimeString();
        const color =
          type === "error" ? "red" : type === "success" ? "green" : "black";
        logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
        console.log(message);
      }

      // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
      async function initializeSystem() {
        try {
          log("ğŸ”§ å­¦è¡“çš„æ ¹æ‹ ä»˜ãAIè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹...");

          if (typeof AcademicBasedEvaluator === "undefined") {
            log("âŒ AcademicBasedEvaluator ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“", "error");
            return;
          }

          academicEvaluator = new AcademicBasedEvaluator();
          await academicEvaluator.initialize();

          log("âœ… å­¦è¡“ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–å®Œäº†", "success");

          // åˆæœŸåŒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
          const initStatus = document.getElementById("initStatus");
          const citableStudies = academicEvaluator.getCitableStudies();
          initStatus.innerHTML = `
                    <strong>åˆæœŸåŒ–å®Œäº†</strong><br>
                    èª­ã¿è¾¼ã¿å®Œäº†: ${citableStudies.length}ä»¶ã®ç ”ç©¶<br>
                    ${citableStudies
                      .map((study) => `â€¢ ${study.citation}`)
                      .join("<br>")}
                `;
        } catch (error) {
          log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      function loadTestData() {
        testPoseData = {
          keypoints: generateTestKeypoints("expert"),
          timestamp: Date.now(),
        };
        log("ğŸ“Š ãƒ†ã‚¹ãƒˆç”¨ãƒãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†", "success");
      }

      // ãƒ†ã‚¹ãƒˆç”¨keypointsç”Ÿæˆ
      function generateTestKeypoints(skillLevel) {
        const baseKeypoints = [
          { x: 0.5, y: 0.1, score: 0.9 }, // nose
          { x: 0.48, y: 0.08, score: 0.9 }, // left_eye
          { x: 0.52, y: 0.08, score: 0.9 }, // right_eye
          { x: 0.46, y: 0.09, score: 0.9 }, // left_ear
          { x: 0.54, y: 0.09, score: 0.9 }, // right_ear
          { x: 0.4, y: 0.25, score: 0.95 }, // left_shoulder
          { x: 0.6, y: 0.25, score: 0.95 }, // right_shoulder
          { x: 0.35, y: 0.4, score: 0.9 }, // left_elbow
          { x: 0.65, y: 0.4, score: 0.9 }, // right_elbow
          { x: 0.3, y: 0.55, score: 0.9 }, // left_wrist
          { x: 0.7, y: 0.55, score: 0.9 }, // right_wrist
          { x: 0.45, y: 0.65, score: 0.9 }, // left_hip
          { x: 0.55, y: 0.65, score: 0.9 }, // right_hip
          { x: 0.43, y: 0.8, score: 0.9 }, // left_knee
          { x: 0.57, y: 0.8, score: 0.9 }, // right_knee
          { x: 0.41, y: 0.95, score: 0.9 }, // left_ankle
          { x: 0.59, y: 0.95, score: 0.9 }, // right_ankle
        ];

        // ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦èª¿æ•´
        if (skillLevel === "expert") {
          // å®‰å®šã—ãŸãƒ•ã‚©ãƒ¼ãƒ 
          baseKeypoints[8].y -= 0.05; // å³è‚˜ã‚’å°‘ã—ä¸Šã’ã‚‹
          baseKeypoints[10].y -= 0.02; // å³æ‰‹é¦–èª¿æ•´
        } else if (skillLevel === "beginner") {
          // ä¸å®‰å®šãªãƒ•ã‚©ãƒ¼ãƒ 
          baseKeypoints[8].y += 0.08; // å³è‚˜ãŒä¸‹ãŒã‚‹
          baseKeypoints[13].y += 0.05; // å·¦è†ãŒä¼¸ã³ã‚‹
          baseKeypoints[14].y += 0.05; // å³è†ãŒä¼¸ã³ã‚‹
        }

        return baseKeypoints;
      }

      // ç†Ÿç·´è€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ†ã‚¹ãƒˆ
      async function runExpertTest() {
        if (!academicEvaluator) {
          log("âŒ ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“", "error");
          return;
        }

        try {
          log("ğŸ§ª ç†Ÿç·´è€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡é–‹å§‹...");

          const expertPose = {
            keypoints: generateTestKeypoints("expert"),
            timestamp: Date.now(),
          };

          const evaluation =
            await academicEvaluator.evaluateWithAcademicEvidence(expertPose);
          displayEvaluationResults(evaluation, "expert");

          log("âœ… ç†Ÿç·´è€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡å®Œäº†", "success");
        } catch (error) {
          log(`âŒ è©•ä¾¡ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // ä¸­ç´šè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ†ã‚¹ãƒˆ
      async function runIntermediateTest() {
        if (!academicEvaluator) {
          log("âŒ ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“", "error");
          return;
        }

        try {
          log("ğŸ§ª ä¸­ç´šè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡é–‹å§‹...");

          const intermediatePose = {
            keypoints: generateTestKeypoints("intermediate"),
            timestamp: Date.now(),
          };

          const evaluation =
            await academicEvaluator.evaluateWithAcademicEvidence(
              intermediatePose
            );
          displayEvaluationResults(evaluation, "intermediate");

          log("âœ… ä¸­ç´šè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡å®Œäº†", "success");
        } catch (error) {
          log(`âŒ è©•ä¾¡ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // åˆå¿ƒè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ†ã‚¹ãƒˆ
      async function runBeginnerTest() {
        if (!academicEvaluator) {
          log("âŒ ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“", "error");
          return;
        }

        try {
          log("ğŸ§ª åˆå¿ƒè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡é–‹å§‹...");

          const beginnerPose = {
            keypoints: generateTestKeypoints("beginner"),
            timestamp: Date.now(),
          };

          const evaluation =
            await academicEvaluator.evaluateWithAcademicEvidence(beginnerPose);
          displayEvaluationResults(evaluation, "beginner");

          log("âœ… åˆå¿ƒè€…ãƒ¬ãƒ™ãƒ«è©•ä¾¡å®Œäº†", "success");
        } catch (error) {
          log(`âŒ è©•ä¾¡ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // è©•ä¾¡çµæœè¡¨ç¤º
      function displayEvaluationResults(evaluation, testType) {
        const resultsDiv = document.getElementById("testResults");
        const academicDiv = document.getElementById("academicEvidence");

        // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤º
        resultsDiv.innerHTML = `
                <div class="academic-summary">
                    <h4>ğŸ“Š ${testType.toUpperCase()} ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>ç·åˆè©•ä¾¡:</strong> ${
                      evaluation.overall_assessment
                    }</p>
                    <p><strong>ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«äºˆæ¸¬:</strong> ${
                      evaluation.skill_level_prediction
                    }</p>
                    <p><strong>ä¿¡é ¼åº¦:</strong> ${Math.round(
                      evaluation.confidence_score
                    )}%</p>
                    <p><strong>è©•ä¾¡æ™‚åˆ»:</strong> ${new Date(
                      evaluation.timestamp
                    ).toLocaleTimeString()}</p>
                </div>
            `;

        // å­¦è¡“çš„æ ¹æ‹ è¡¨ç¤º
        academicDiv.innerHTML = `
                <div class="thesis-ready">
                    <h4>ğŸ“š å‚ç…§ã—ãŸå­¦è¡“æ–‡çŒ®</h4>
                    ${evaluation.cited_studies
                      .map((study) => `<div class="citation">${study}</div>`)
                      .join("")}
                    
                    <h5>ğŸ”¬ è©•ä¾¡æ ¹æ‹ ã®è©³ç´°</h5>
                    ${Object.entries(evaluation.academic_evidence)
                      .map(
                        ([source, data]) => `
                        <div style="margin: 10px 0; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <strong>${source}:</strong> ${
                          data.study_citation || data.title || "è©³ç´°ãƒ‡ãƒ¼ã‚¿"
                        }
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;

        // å’ç ”ç™ºè¡¨ç”¨ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        const thesisData = {
          testType: testType,
          timestamp: new Date().toISOString(),
          evaluation: evaluation,
          academic_evidence: evaluation.academic_evidence,
          cited_studies: evaluation.cited_studies,
        };

        saveThesisData(thesisData);
      }

      // å’ç ”ãƒ‡ãƒ¼ã‚¿ä¿å­˜
      function saveThesisData(data) {
        const existingData = JSON.parse(
          localStorage.getItem("thesis_test_results") || "[]"
        );
        existingData.push(data);
        localStorage.setItem(
          "thesis_test_results",
          JSON.stringify(existingData)
        );
        log(`ğŸ’¾ å’ç ”ãƒ‡ãƒ¼ã‚¿ä¿å­˜: ${data.testType}ãƒ¬ãƒ™ãƒ«`, "success");
      }

      // å’ç ”ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
      function showThesisData() {
        const thesisData = JSON.parse(
          localStorage.getItem("thesis_test_results") || "[]"
        );
        const displayDiv = document.getElementById("thesisDataDisplay");

        if (thesisData.length === 0) {
          displayDiv.innerHTML = "<p>ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
          return;
        }

        displayDiv.innerHTML = `
                <div class="thesis-ready">
                    <h4>ğŸ’¾ ä¿å­˜ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ (${thesisData.length}ä»¶)</h4>
                    ${thesisData
                      .map(
                        (data, index) => `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #007bff; border-radius: 4px;">
                            <h5>ãƒ†ã‚¹ãƒˆ${index + 1}: ${data.testType}ãƒ¬ãƒ™ãƒ«</h5>
                            <p><strong>å®Ÿè¡Œæ™‚åˆ»:</strong> ${new Date(
                              data.timestamp
                            ).toLocaleString()}</p>
                            <p><strong>ç·åˆè©•ä¾¡:</strong> ${
                              data.evaluation.overall_assessment
                            }</p>
                            <p><strong>å‚ç…§è«–æ–‡æ•°:</strong> ${
                              data.cited_studies.length
                            }ä»¶</p>
                            <p><strong>ä¿¡é ¼åº¦:</strong> ${Math.round(
                              data.evaluation.confidence_score
                            )}%</p>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;
      }

      // ç™ºè¡¨ç”¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      function exportThesisData() {
        const thesisData = JSON.parse(
          localStorage.getItem("thesis_test_results") || "[]"
        );

        if (thesisData.length === 0) {
          alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
          return;
        }

        const exportData = {
          export_date: new Date().toISOString(),
          system_info: {
            name: "å­¦è¡“çš„æ ¹æ‹ ä»˜ãAIè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ",
            version: "1.0.0",
            academic_databases: academicEvaluator
              ? academicEvaluator.getCitableStudies().length
              : 0,
          },
          test_results: thesisData,
          summary: {
            total_tests: thesisData.length,
            test_types: [...new Set(thesisData.map((d) => d.testType))],
            unique_citations: [
              ...new Set(thesisData.flatMap((d) => d.cited_studies)),
            ],
          },
        };

        const blob = new Blob([JSON.stringify(exportData, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `thesis_ai_evaluation_data_${
          new Date().toISOString().split("T")[0]
        }.json`;
        a.click();
        URL.revokeObjectURL(url);

        log("ğŸ“¤ ç™ºè¡¨ç”¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†", "success");
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
      function clearThesisData() {
        if (confirm("ä¿å­˜ã•ã‚ŒãŸå’ç ”ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
          localStorage.removeItem("thesis_test_results");
          document.getElementById("thesisDataDisplay").innerHTML =
            "<p>ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚</p>";
          log("ğŸ—‘ï¸ å’ç ”ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†", "success");
        }
      }

      // ãƒ­ã‚°ã‚¯ãƒªã‚¢
      function clearLog() {
        document.getElementById("systemLog").innerHTML = "";
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
      window.addEventListener("load", () => {
        log("ğŸš€ å­¦è¡“çš„æ ¹æ‹ ä»˜ãAIè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ  - å‹•ä½œç¢ºèªãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†");
        log(
          "ğŸ’¡ ã¾ãšã€Œå­¦è¡“ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„"
        );
      });
    </script>
  </body>
</html>
